<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.hli.persistence.AdminMapper">

<insert id="insertGoods" parameterType="GoodsVO">
	INSERT INTO goods(provider, brand_name, goods_name, goods_code, thumbnail, market_price, sell_price, goods_info, use_note, use_term, updated) 
	values(#{provider}, #{brand_name}, #{goods_name}, #{goods_code}, #{thumbnail}, #{market_price}, #{sell_price}, #{goods_info}, #{use_note}, #{use_term}, now());
</insert>

<update id="updateGoods" parameterType="GoodsVO">
	UPDATE goods
	<set>
		updated = now(),
		<if test="provider != 0">provider=#{provider},</if>
		<if test="brand_name != null">brand_name=#{brand_name},</if>
		<if test="goods_name != null">goods_name=#{goods_name},</if>
		<if test="goods_code != null">goods_code=#{goods_code},</if>
		<if test="thumbnail != null">thumbnail=#{thumbnail},</if>
		<if test="market_price != null">market_price=#{market_price},</if>
		<if test="sell_price != null">sell_price=#{sell_price},</if>
		<if test="goods_info != null">goods_info=#{goods_info},</if>
		<if test="use_note != null">sell_price=#{use_note},</if>
		<if test="use_term != null">use_term=#{use_term}</if>
	</set>
	WHERE goods_id = #{goods_id} 
</update>

<select id="selectGoods" parameterType="GoodsVO" resultType="GoodsVO">
	SELECT * FROM goods 
	WHERE goods_code = #{goods_code}
	Limit 1
</select>

<select id="selectGoodsList" parameterType="SearchVO" resultType="GoodsVO">
	SELECT * FROM goods
	LIMIT #{start_index}, #{page_size}
</select>

<select id="countGoods" parameterType="SearchVO" resultType="Integer">
	SELECT count(*) FROM goods
</select>


<insert id="insertManager" parameterType="ManagerVO">
	INSERT INTO manager(id, pass, name, role_id)
		VALUES(HEX(AES_ENCRYPT(#{id}, 'hlint')), password(#{pass}), HEX(AES_ENCRYPT(#{name}, 'hlint')), #{role_id});
</insert>

<update id="updateManager" parameterType="ManagerVO">
	UPDATE manager
	<set>
		<if test="id != null">id=HEX(AES_ENCRYPT(#{id}, 'hlint')),</if>
		<if test="pass != null">pass=password(#{pass}),</if>
		<if test="name != null">name=HEX(AES_ENCRYPT(#{name}, 'hlint')),</if>
		<if test="role_id != 0">role_id=#{role_id}</if>
	</set>
	WHERE manager_id = #{manager_id}
</update>

<delete id="deleteManager" parameterType="ManagerVO">
	DELETE FROM manager
	WHERE manager_id = #{manager_id}
</delete>

<select id="countManager" parameterType="SearchVO" resultType="Integer">
	SELECT count(*) FROM manager
</select>

<select id="selectManager" parameterType="ManagerVO" resultType="ManagerVO">
	SELECT 
		manager_id,
		CAST(AES_DECRYPT(unhex(id), 'hlint') AS CHAR(100)) as 'id',
		pass,
		CAST(AES_DECRYPT(unhex(name), 'hlint') AS CHAR(100)) as 'name',
		role_id 
	FROM manager
	WHERE  
		 <choose>
		 	<when test="manager_id == 0">
		 		id=HEX(AES_ENCRYPT(#{id}, 'hlint')) AND pass=password(#{pass})	
		 	</when>
		 	<otherwise>
		 		manager_id=#{manager_id}
		 	</otherwise>
		 </choose>
	Limit 1
</select>

<select id="selectManagerList" parameterType="SearchVO" resultType="ManagerVO">
	SELECT 
		manager_id,
		CAST(AES_DECRYPT(unhex(id), 'hlint') AS CHAR(20)) as 'id',
		pass,
		CAST(AES_DECRYPT(unhex(name), 'hlint') AS CHAR(20)) as 'name',
		role_id
	FROM manager
	ORDER BY name
	<if test="page_size != 0">
		LIMIT #{start_index}, #{page_size}
	</if>
</select>

</mapper>